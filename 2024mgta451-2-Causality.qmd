---
title: "Causality & Advertising"
subtitle: "UCSD MGTA 451-Marketing"
author: "Kenneth C. Wilbur"
output: html_document
format: 
  revealjs:
    auto-stretch: false
    theme: default
slide-number: c 
editor_options: 
  chunk_output_type: inline 
---

##  

![](images/margarine.svg){fig-align="center" width=9in}


## 

- Suppose 10 outcomes, 1000 predictors, N=100,000 obs

          - Outcomes might include visits, sales, reviews, ...
          - Predictors might include customer attributes, session attributes, ...

- Suppose everything is noise, no true relationships

          - The distribution of the 10,000 correlation coefficients would be Normal, tightly centered around zero

          - A 2-sided test of {corr == 0} would reject at 95% if |r|>.0062

- We should expect 500 false positives 

          - What is a 'false positive' exactly?

- In general, what can we learn from a significant correlation?

::: aside
* [This R Script](https://drive.google.com/file/d/1NuHbXi8QNVkaJQ7QXBWiHqHfvtUaXlCC/view?usp=sharing){target="_blank"} simulates this scenario
:::

## 

![](images/BingRevenueTooHighTreatment.png){fig-align="center" height=7in}

::: aside
[source](https://www.amazon.com/Power-Experiments-Decision-Making-Understanding/dp/0544113966){target="_blank"}
:::
 
::: notes
This AB test triggered a "revenue too high" alert at Microsoft Bing in 2012
The treatment improved horizontal space usage and enlarged a selling argument in search ads
Bing had a robust experimentation platform and culture. They run over 10k tests/year
The RTH alert indicates a possible code error that might be defrauding advertisers
In this case it was just a really big treatment effect, biggest ever.
This change increased revenue 12% without significant harm to user experience metrics. Over $100 million per year
We can explain it ex post (HARKing) but nobody expected such a big effect 
:::
 
## 

![](images/CvC.png){fig-align="center" width=9in}
 
::: notes
Key point here: The Correlation guy is not just silly or harmless. 
He's weighing down the truck.
& there is an opportunity cost to having him in the truck, which is that he could 
be pushing the truck instead.
:::
 
::: aside
[source](https://s3.amazonaws.com/fieldexperiments-papers2/papers/00779.pdf)
:::
 
# Agenda

- Causality
- Experiments
- Quasi-experiments
- Correlations
- Ad/sales frameworks

## 

![](images/4typesofanalytics.png){fig-align="center" width=9in}

::: aside
-   Causality matters for diagnostic and prescriptive analytics, not descriptive or predictive
:::

## Causal Inference

-   Suppose we have a binary "treatment" or "policy" variable $T_i$ that we can "assign" to person $i$

        - Examples: Advertise, Serve a design, Recommend
        - "Treatment" terminology came from medical literature

-   Suppose person $i$ could have a binary potential "response" variable $Y_i(T_i)$

        - Examples: Visit site, Click product, Add to Cart, Purchase, Rate, Review
        - Looks like the marketing funnel model we saw previously

- Important: $Y_i$ may depend fully, partially, or not at all on $T_i$, and the dependence may be different for different people



## Why care?

- We want to maximize profits $\pi_i(Y_i(T_i), T_i)$ 

- Suppose $Y_i=1$ contributes to revenue; then $\frac{d\pi_i}{dY_i} >0$ 

- Suppose $T_i=1$ is costly; then $\frac{d\pi_i}{dT_i}=\frac{\partial \pi_i}{\partial Y_i}\frac{\partial Y_i}{\partial T_i}+\frac{\partial \pi_i}{\partial T_i}$

- We have to know $\frac{\partial Y_i}{\partial T_i}$ to optimize $T_i$ assignments

        - Called the "treatment effect" (TE) 

- Profits may decrease if we misallocate $T_i$

## **Fundamental Problem of Causal Inference**

-   We can only observe **either** $Y_i(T_i=1)$ **or** $Y_i(T_i=0)$, but not both, for each person $i$

- This is a missing-data problem that we cannot resolve. We only have one reality

          - The case we don't observe is called the "counterfactual"

::: aside
[Rubin Causal Model](https://en.wikipedia.org/wiki/Rubin_causal_model){target="_blank"}
:::

## So what can we do? {.smaller}

1. Experiment. Randomize $T_i$ and estimate $\frac{\partial Y_i}{\partial T_i}$ as avg  $Y_i(T_i=1)-Y_i(T_i=0)$

        - Creates new data; costs time, money, attention; deceptively difficult to design and then act on

2. Use assumptions & data to estimate a "quasi-experimental" average treatment effect using archival data

        - Requires expertise, time, attention; difficult to validate; not always possible

3. Use correlations: Assume past treatments were assigned randomly, use past data to estimate $\frac{\partial Y_i}{\partial T_i}$

        - Easiest approach; but T is only randomly assigned when we run an experiment, so what exactly are we doing here?

4. Fuhgeddaboutit, go with the vibes, do what we feel

## How much does causality matter?

          - How hard should we work?

- Organizational returns or costs of getting it right?

- Data thickness: How likely can we get a good estimate?

- How does empirical approach fit with organizational analytics culture? Can we act on what we learn? 

- Individual considerations: promotion, bonus, reputation, career; Will credit be stolen or blame be shared? 

- Accountability: Will ex-post attributions verify findings? Will results threaten or complement rival teams/execs?


        
## Ad/sales example: Experiment {.scrollable .smaller}

1. Randomly assign ads to customer groups on a platform; measure sales in each group, e.g. [Link](https://www.facebook.com/business/learn/lessons/how-to-make-your-ads-more-effective){target="_blank"}

        - Often called "incrementality" in ad/sales context

        - Pros: AB testing is easy to understand, easy to implement, easy to validate
        
        - Cons: Can we trust the platform's "black box"? Will we get the data and all available insights? Could platform knowledge affect future ad costs?
 
2. Randomly assign messages within a campaign 
      
3. Randomly choose times, places, segments or combinations; compare treated times to controls
        
4. Randomize over budgets and bids

5. Randomly choose platforms, publishers, behavioral targets, etc., to compare RoAS across options

          RoAS = Return on Ad Spend. Usually, RoAS = Sales / AdSpend. Sometimes, =(Sales-AdSpend)/AdSpend

## 2. Ad/sales example: Experiment {.scrollable}

Key issues for any experimental design: 
        
        - Always run A:A test first. Validate the infrastructure before trusting a result
        
        - Can we agree on the opportunity cost of the experiment? "Priors"
        
        - How will we act on the (uncertain) findings? Have to decide before we design
        
        - Example: Suppose we estimate RoAS at 0.5 with a 95% confidence interval of [0.45, 0.55]. Or, suppose we estimate RoAS at 0.5, but we have a 95% confidence interval of [-2.1], 3.1]. What will we do with this information?
        

## Before quasi-experiments: Vocab {.smaller }

**Model**: Mathematical relationship between variables that simplifies reality, eg y=xb+e

**Identification strategy**: Set of assumptions that isolate a causal effect $\frac{\partial Y_i}{\partial T_i}$ from other factors that may influence $Y_i$

          - A system to compare apples with apples, not apples with oranges

We say we "identify" the causal effect if we have an identification strategy that reliably distinguishes $\frac{\partial Y_i}{\partial T_i}$ from possibly correlated unobserved factors that also influence $Y_i$

If you estimate a model without an identification strategy, you should interpret the results as correlational

You can have an identification strategy without a model, e.g. <br>avg  $Y_i(T_i=1)-Y_i(T_i=0)$

Usually you want both. Models help with quantifying uncertainty and estimating treatment effects by controlling for relevant observables


## 2. Ad/sales: Quasi-experiments

Goal: Find a "natural experiment" in which $T_i$ is "as if" randomly assigned, to identify $\frac{\partial T_i}{\partial Y_i}$

Possibilities:

          - Firm starts, stops or pulses advertising without changing other variables, especially when staggered across times or geos
          - Competitor starts, stops or pulses advertising
          - Change in ad prices, availability or targeting for exogenous reasons that don't affect Y (e.g., election or outage)
          - Discontinuous ad copy/campaign changes without changing other variables 


## DraftKings and FanDuel TV ad effects on Google Search

![](images/dfs_search_2015.png){fig-align="center" width=9in}          

::: aside
[source](https://drive.google.com/file/d/175yrLDY-W15TgBtumPa11WnwMwCeUmSF/view){target="_blank"}
:::

## Ad/sales: Quasi-experiments (2){.scrollable .smaller}

Or, construct a "control group"

- Customers or markets with similar demand trends where the firm never advertised

- Competitors or complementors with similar demand trends that don't advertise

Techniques like "difference in differences," "synthetic control," "regression discontinuity," "matching," and "instrumental variables" can help

In each case, we try to predict our missing counterfactual data, then estimate the causal effect as observed outcomes minus predicted outcomes


## 3. Ad/sales example: Correlational

Just get historical data on $Y_i$ and $T_i$ and run a regression

           Most people use OLS, but Google's CausalImpact R package is also popular

The implicit assumption is either that there are no unobservables that influence both $Y_i$ and $T_i$ ; or that we are OK with a correlation

          "Better to be vaguely right than precisely wrong"
          But are we the guy in the truck bed?
          
## 3. Problem 1 with corr(ad,sales)

Advertisers try hard to maximize ad effects

We select messages, media, times, contexts, target audiences, publishers (etc.) to maximize potential impact 

Sometimes, we use ML algos that max corr(ad,sales)

So, if you assume that past $T_i$ was random, it's functionally equivalent to assuming that the advertising team is incompetent

          - This type of selection/treatment problem is common in marketing


## 3. Problem 2 with corr(ad,sales)

Suppose you wisely advertise only in places where you expect a big response

            E.g. you advertise surfboards in coastal cities with big waves, but not in landlocked cities

You'll get a big correlation between ads and sales, partly because of differences in addressable market sizes

            More ads in san diego, more surfboard sales in san diego

            Corr(ad,sales) would overestimate the causal effect of ads on sales, and likely lead you to spend too much on ads in san diego

Many, many firms basically do this


## Why are some teams OK with corr(ad,sales)?

1. Some worry that if ads go to zero -> sales go to zero

        - For small firms or new products, this may be good logic
        - If this is true, then the correlation is the causal effect
        - Directly suggests an inexpensive experimental design
        - Claim directly implies a huge customer satisfaction problem. Happy customers usually share their experiences with others. If you really believe this is true, try a referral program

2. Some firms assume that correlations indicate direction of causal results

        - The guy in the truck bed is not pushing backwards right?
        - But what is this assumption based on?
        - Direction is only part of the picture; what about effect size?
        - Unfortunately, if it's hard to get a causal estimate, then this assumption is probably ill founded


## Why are some teams OK with corr(ad,sales)?

3. CFO and CMO negotiate ad budget

        - CFO asks for proof that ads work
        - CMO asks ad agencies, platforms & marketing team for proof
        - CMO sends proof to CFO ; We all carry on
        - Things may change if ad effects team reports to CFO

4. Few rigorous analytics cultures or ex-post checks

        - Downside of lost sales may exceed downside of foregone profits

5.Estimating causal effects of ads can be pretty difficult

        - Many firms lack expertise, patience, execution skill
        - Ad/sales tests may be statistically inconclusive, especially if small
        - Tests are often designed without subsequent actions in mind

## Why are some teams OK with corr(ad,sales)?

6. Platforms often provide correlational ad/sales estimates

        - Which one do you think is larger, correlational or experimental ad effect estimates?
        - Which one would most client marketers prefer?
        - Platform estimates are typically "black box" without neutral auditors
        - Sometimes platforms respond to marketing executive demand for good numbers
        - "Nobody ever got fired for buying [famous platform brand here]"

7. Historically, most advertising work was done by agency professionals

        - Agency compensation usually relies on spending, not incremental sales
        - Principal/agent problems are common
        - "Advertising attribution" is all about maximizing credit to ads
        - These days, most marketers have in-house agencies, and split work


## 

![](images/incrementality.png){fig-align="center" width=9in}

## 

![](images/gtrends_adexp.png){fig-align="center" width=9in}


          - I believe we're at the start of a generational shift

##

![](images/adsalesratios2024.png){fig-align="center" width=5in}

- Typical net margin: 8-10% ([see Damodaran](https://pages.stern.nyu.edu/~adamodar/New_Home_Page/datafile/margin.html){target="_blank"})
- Ads finance information production

::: aside
[SAI Books source](https://saibooks.com/advertising-sales-ratios/){target="_blank"}
:::
::: notes
[also relevant](https://www.rab.com/research/10014.pdf){target="_blank"}
:::

## 

![](images/hawksem.png){fig-align="center" width=7in}

::: aside
- Maybe the right question is what % of sales to spend on experiments to get more sales
:::


## Marketing Mix Model {.smaller}

- The "marketing mix" consists of quantifiable marketing efforts, such as product line, length and features; price and price promotions; advertising, PR, social media and other communication efforts; retail distribution intensity and quality; etc.

- A "marketing mix model" quantifies the relationship between marketing mix variables and outcomes

          - Idea goes back to the 1950s
          - E.g., suppose we increase price & ads at the same time
          - Or, suppose ads increased demand, and then inventory-based systems raised prices

- A "media mix model" quantifies numerous advertising efforts and relates them to sales

          - For example, suppose the brand bought ads from 000s of publishers
          - Confusingly, both abbreviated MMM and often feature similar structures

- MMM goal is to quantify past marketing mix effects, to better inform future efforts


## MMM elements {.smaller}

Typically, MMM uses geo/time data

          - Outcome: usually sales. Could include more funnel metrics (visits, leads, ...)
          - Predictors: Marketing mix factors under our control, plus competitor variables, seasonality, macroeconomic factors, + any other demand shifters

Model structure is usually some type of panel regression, vector autoregression, or bayesian model

          - Often includes lags, interactions, and other nonlinear terms
          - Regressions typically estimate marginal effects, not average effects
          - Nonlinearities built into the model, such as Inc or Dec returns to ad spend, can drive key results

MMM often used to retrospectively evaluate advertising media and copy, advertising interactions, and inform future ad budgets

          - MMM can be used for prediction but should be calibrated appropriately


## MMM Challenges

- Without experimental data, MMM results are correlational

- Data availability, accuracy and granularity are all critical

- MMM requires sufficient variation in predictors, else it cannot estimate coefficients

- "Model uncertainty" :  Results can be strongly sensitive to modeling choices

- For much more, see this [MSI White Paper](https://github.com/kennethcwilbur/website/raw/master/MSI-MMM-Blue-Ribbon-Panel-Report-Updated.pdf){target="_blank"} or the [MMM Wikipedia article](https://en.wikipedia.org/wiki/Marketing_mix_modeling){target="_blank"}
          
          
## Other Popular Ad/Sales Approaches

          Remember, model <> identification strategy

- Lift Tests

- Multi-touch attribution (MTA)

          - Seeks to allocate "credit" for sales across advertising touchpoints
          - Related: First-touch attribution, last-touch attribution

- Cookie-based approaches vs. Google's Privacy Sandbox 

- Ghost ads 

- Other platform-provided experimentation tools

## 

![](images/li1.png){fig-align="center" width=6in}

## 

![](images/li2.png){fig-align="center" width=11in}

::: notes
It's interesting that comments mainly came from those with little to lose
:::


## Takeaways

- Fundamental Problem of Causal Inference: We can't observe all data needed to optimize actions. This is a missing-data problem

- Approaches: Experiments, Quasi-experiments, Correlations, Ignore

- Experiments are the gold standard, but are costly and difficult to design, implement and act on

- It's likely that most large firms spend too much on ads

![](images/recap.png){fig-align="right" width="2in"}

## Going deeper{.smaller}

- [What is Incrementality? And How Do We Measure it in 2024?](https://www.incrmntal.com/resources/how-do-we-measure-incrementality){target="_blank"}

- [Inferno: A Guide to Field Experiments in Online Display Advertising](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3581396){target="_blank"}: Covers frequent problems in online advertising experiments

-   [Inefficiencies in Digital Advertising Markets](https://arxiv.org/abs/1912.09012){target="_blank"}: Discusses digital RoAS estimation challenges and remedies

-  [The Power of Experiments](https://direct.mit.edu/books/book/5468/The-Power-of-ExperimentsDecision-Making-in-a-Data){target="_blank"}: Goes deep on digital test-and-learn considerations

- [New Developments in Experimental Design and Analysis
 (2024)](https://www.youtube.com/watch?v=CMO2NsxQXt4) by Athey & Imbens

- [Mostly Harmless Econometrics](https://www.amazon.com/Mostly-Harmless-Econometrics-Empiricists-Companion/dp/0691120358){target="_blank"}: Covers quasi-experimental techniques

![](images/takingoff.png){fig-align="right" width="2in"}
